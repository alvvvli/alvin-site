<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Shinkansen Shuffle â€” WEX Lab</title>
<style>
  :root{
    --bg:#0b0f14; --panel:#0f172a; --rail:#1b2437; --ink:#e6eef9; --muted:#9fb4d1;
    --accent:#60a5fa; --ok:#16a34a; --bad:#ef4444; --warn:#eab308; --platform:#111827;
    --line:#1f2a44; --faint:rgba(255,255,255,.06);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.5 system-ui,Segoe UI,Roboto,Ubuntu,sans-serif}
  .wrap{max-width:1100px;margin:0 auto;padding:18px}
  header{display:flex;align-items:center;gap:10px;margin-bottom:12px}
  h1{font-size:20px;margin:0}
  .tag{font-size:12px;padding:4px 8px;border:1px solid var(--line);border-radius:999px;color:var(--muted)}

  .hud{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin:8px 0 14px}
  .hud .card{background:var(--panel);padding:10px 14px;border-radius:14px;box-shadow:0 4px 24px rgba(0,0,0,.35);border:1px solid var(--line)}
  .hud strong{display:block;font-size:18px}
  .btn{appearance:none;border:none;background:var(--accent);color:#081016;font-weight:700;padding:10px 14px;border-radius:14px;cursor:pointer}
  .btn.ghost{background:transparent;color:var(--ink);border:1px solid var(--line)}

  /* BOARD */
  .board{position:relative;background:linear-gradient(180deg,var(--panel),#0b121d);border:1px solid var(--line);border-radius:16px;overflow:hidden;min-height:520px}
  .sky{position:absolute;inset:0;background:radial-gradient(1000px 300px at 70% 0%,rgba(96,165,250,.15),transparent)}
  .lanes{position:absolute;inset:72px 0 0 0;display:grid;grid-template-columns:repeat(5,1fr);gap:0;height:calc(100% - 72px)}
  .platform{position:relative;border-left:1px solid var(--faint)}
  .platform:first-child{border-left:none}
  .platform::before{content:"";position:absolute;left:0;right:0;top:44px;height:4px;background:repeating-linear-gradient(90deg,var(--rail) 0 16px,transparent 16px 24px)}
  .platform .label{position:absolute;top:10px;left:10px;font:600 13px/1 system-ui;opacity:.8}
  .platform .target{position:absolute;left:6px;right:6px;bottom:10px;height:68px;border:1px dashed var(--line);border-radius:12px;display:flex;align-items:center;justify-content:center;color:var(--muted)}

  /* TRAINS */
  .train{position:absolute;top:96px;width:160px;height:42px;border-radius:40px;background:#e8f2ff;color:#0b0f14;box-shadow:0 8px 24px rgba(0,0,0,.35);
         border:2px solid rgba(0,0,0,.08);display:flex;align-items:center;gap:10px;padding:0 12px;cursor:grab;touch-action:none;}
  .train:active{cursor:grabbing}
  .nose{width:14px;height:14px;border-radius:50%;background:currentColor;opacity:.9}
  .cars{display:flex;gap:4px;margin-left:auto}
  .car{width:14px;height:8px;border-radius:2px;background:rgba(0,0,0,.35)}
  .badge{font-size:11px;padding:2px 8px;border-radius:999px;color:#091018;background:var(--accent);font-weight:700}

  /* Liveries (approximate colors, based on operators) */
  /* E5/H5: upper green, lower white, pink (E5) or purple (H5) stripe */
  .livery-e5{background:
      linear-gradient( to bottom, #00a489 0 50%, #e8f2ff 50% 100%),
      linear-gradient( to right, transparent 0 16%, #ff5fa2 16% 24%, transparent 24% 100%);
    background-blend-mode: normal; background-repeat:no-repeat;}
  .livery-h5{background:
      linear-gradient( to bottom, #00a489 0 50%, #e8f2ff 50% 100%),
      linear-gradient( to right, transparent 0 16%, #8a63d2 16% 24%, transparent 24% 100%);
    background-blend-mode: normal; background-repeat:no-repeat;}
  /* E6: crimson roof, white body, silver stripe */
  .livery-e6{background:
      linear-gradient( to bottom, #b4002d 0 38%, #e8f2ff 38% 100%),
      linear-gradient( to right, transparent 0 18%, #c0c6cf 18% 24%, transparent 24% 100%);
    background-blend-mode: normal; background-repeat:no-repeat;}
  /* E7/W7: ivory body, sky-blue roof, copper + blue lining */
  .livery-e7{background:
      linear-gradient( to bottom, #6ba5ff 0 34%, #efe9db 34% 100%),
      linear-gradient( to right, transparent 0 18%, #b87333 18% 21%, #6ba5ff 21% 24%, transparent 24% 100%);
    background-blend-mode: normal; background-repeat:no-repeat;}
  /* N700S: white with blue stripe */
  .livery-n700s{background:
      linear-gradient( to bottom, #f6fbff 0 100%),
      linear-gradient( to right, transparent 0 18%, #2456ff 18% 24%, transparent 24% 100%);
    background-blend-mode: normal; background-repeat:no-repeat;}
  /* 800: white with red stripe (JR Kyushu) */
  .livery-800{background:
      linear-gradient( to bottom, #ffffff 0 100%),
      linear-gradient( to right, transparent 0 18%, #d12b2b 18% 24%, transparent 24% 100%);
    background-blend-mode: normal; background-repeat:no-repeat;}

  .theme-red{--accent:#fb7185}
  .theme-green{--accent:#34d399}
  .theme-yellow{--accent:#facc15}
  .theme-purple{--accent:#c084fc}
  .theme-blue{--accent:#60a5fa}

  /* TOASTS */
  .toast{position:absolute;left:50%;top:18px;transform:translateX(-50%);background:#0b111c;border:1px solid var(--line);padding:10px 14px;border-radius:12px;color:var(--ink);opacity:0;pointer-events:none;transition:opacity .2s, transform .3s}
  .toast.show{opacity:1;transform:translate(-50%,0)}
  .toast.bad{border-color:#3b0d14;color:#ff8aa0}
  .toast.good{border-color:#0d3b1b;color:#9fffd0}

  /* MODAL */
  dialog{border:none;border-radius:16px;background:#0c1422;color:var(--ink);padding:22px;max-width:560px;box-shadow:0 20px 80px rgba(0,0,0,.55);border:1px solid var(--line)}
  dialog::backdrop{background:rgba(0,0,0,.5)}
  dialog h2{margin:0 0 6px}
  dialog .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid var(--line);color:var(--muted);font-size:12px}

  /* MOBILE */
  @media (max-width:850px){
    .lanes{inset:88px 0 0}
    .train{width:140px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ðŸš„ Shinkansen Shuffle</h1>
      <span class="tag">WEX Interactive Lab</span>
    </header>

    <div class="hud">
      <div class="card" id="scoreBox">Score <strong id="score">0</strong></div>
      <div class="card">Time <strong id="time">60</strong>s</div>
      <div class="card">Combo <strong id="combo">x1</strong></div>
      <button class="btn" id="playBtn">Start</button>
      <button class="btn ghost" id="howBtn">How to Play</button>
    </div>

    <div class="board" id="board">
      <div class="sky"></div>
      <div class="lanes" id="lanes">
        <!-- Five platforms -->
      </div>
      <div class="toast" id="toast"></div>
    </div>
  </div>

  <dialog id="howDialog">
    <h2>How to Play</h2>
    <p>Drag each incoming train to the <strong>matching platform</strong> before it reaches the end. 
      Drop inside the dashed zone to dispatch on time. Correct drops build <strong>combo</strong> and boost points.
      Wrong drops trigger a <em>delay announcement</em> and reset combo. You have 60 seconds â€” aim for JR Pro!</p>
    <div class="grid">
      <div><span class="pill">Perfect dispatch</span> +100 Ã— combo</div>
      <div><span class="pill">Early drop</span> +60</div>
      <div><span class="pill">Late drop</span> +40</div>
      <div><span class="pill bad">Wrong lane</span> âˆ’75 & reset combo</div>
    </div>
    <div style="margin-top:14px;display:flex;gap:10px;justify-content:flex-end">
      <button class="btn ghost" id="closeHow">Close</button>
      <button class="btn" id="startFromHow">Start Game</button>
    </div>
  </dialog>

<script>
(function(){
  const lanesEl = document.getElementById('lanes');
  const board = document.getElementById('board');
  const toast = document.getElementById('toast');
  const scoreEl = document.getElementById('score');
  const timeEl = document.getElementById('time');
  const comboEl = document.getElementById('combo');
  const playBtn = document.getElementById('playBtn');
  const howBtn = document.getElementById('howBtn');
  const howDialog = document.getElementById('howDialog');
  const closeHow = document.getElementById('closeHow');
  const startFromHow = document.getElementById('startFromHow');

  const PLATFORM_COUNT = 5;
  const SPAWN_MS_MIN = 1100, SPAWN_MS_MAX = 1900;
  const TRAIN_SPEED = 0.18; // px per ms

  let running=false, score=0, timeLeft=60, combo=1, tickTimer=null, spawnTimer=null;
  let trains = new Set();

  function initBoard(){
    lanesEl.innerHTML='';
    for(let i=1;i<=PLATFORM_COUNT;i++){
      const p=document.createElement('div'); p.className='platform'; p.dataset.id=i;
      const lab=document.createElement('div'); lab.className='label'; lab.textContent='Platform '+i;
      const t=document.createElement('div'); t.className='target'; t.textContent='Drop Here'; t.dataset.id=i;
      p.append(lab,t); lanesEl.appendChild(p);
    }
  }

  function rand(arr){return arr[Math.floor(Math.random()*arr.length)]}
  function between(a,b){return a+Math.random()*(b-a)}

  function showToast(msg, type){
    toast.textContent=msg; toast.classList.remove('good','bad');
    if(type) toast.classList.add(type);
    toast.classList.add('show');
    setTimeout(()=>toast.classList.remove('show'), 900);
  }

  function startGame(){
    if(running) return; running=true; score=0; timeLeft=60; combo=1; trains.forEach(killTrain); trains.clear();
    scoreEl.textContent=score; timeEl.textContent=timeLeft; comboEl.textContent='x'+combo;
    tickTimer = setInterval(()=>{ timeLeft--; timeEl.textContent=timeLeft; if(timeLeft<=0) endGame(); }, 1000);
    scheduleSpawn();
    showToast('Dispatch started â€” good luck, Chief!', 'good');
  }

  function endGame(){
    running=false; clearInterval(tickTimer); clearTimeout(spawnTimer);
    trains.forEach(killTrain); trains.clear();
    const rank = score>=3500 ? 'JR East Pro' : score>=2500 ? 'Station Master' : score>=1500 ? 'Dispatcher' : 'Conductor';
    showToast(`Time! Score ${score} â€” Rank: ${rank}`, 'good');
    playBtn.textContent='Play Again';
  }

  function scheduleSpawn(){
    if(!running) return;
    spawnTimer = setTimeout(()=>{ spawnTrain(); scheduleSpawn(); }, between(SPAWN_MS_MIN, SPAWN_MS_MAX));
  }

  // Accurate Shinkansen models (operator + livery)
  const MODELS = [
    {code:'E5', name:'Hayabusa', operator:'JR East', livery:'livery-e5'},
    {code:'H5', name:'Hayabusa', operator:'JR Hokkaido', livery:'livery-h5'},
    {code:'E6', name:'Komachi', operator:'JR East', livery:'livery-e6'},
    {code:'E7', name:'Kagayaki', operator:'JR East', livery:'livery-e7'},
    {code:'W7', name:'Kagayaki', operator:'JR West', livery:'livery-e7'},
    {code:'N700S', name:'Nozomi', operator:'JR Central/West/Kyushu', livery:'livery-n700s'},
    {code:'800', name:'Tsubame', operator:'JR Kyushu', livery:'livery-800'}
  ];
  const THEMES=['theme-blue','theme-green','theme-yellow','theme-purple','theme-red'];

  function spawnTrain(){
    const platform = Math.ceil(Math.random()*PLATFORM_COUNT);
    const theme = rand(THEMES);
    const model = rand(MODELS);
    const y = 96 + Math.floor(Math.random()*(board.clientHeight-220));
    const el = document.createElement('div');
    el.className = `train ${theme} ${model.livery}`;
    el.style.top = y + 'px';
    el.style.left = (board.clientWidth + 10) + 'px';
    el.dataset.target = platform;
    el.dataset.vx = - (between(0.12, TRAIN_SPEED));
    el.dataset.model = model.code;

    el.innerHTML = `<span class=\"badge\">P${platform}</span>
                    <span class=\"nose\"></span>
                    <div class=\"cars\">${'<div class=\"car\"></div>'.repeat(5 + Math.floor(Math.random()*4))}</div>
                    <div style=\"position:absolute;left:12px;bottom:-18px;font:600 10px/1 system-ui;color:var(--muted);opacity:.9\">${model.code}</div>`;

    board.appendChild(el);
    const obj = {el, grabbed:false, x: board.clientWidth + 10, y, vx: parseFloat(el.dataset.vx)};
    trains.add(obj);

    // pointer/touch drag
    el.addEventListener('pointerdown', e=>{
      obj.grabbed=true; el.setPointerCapture(e.pointerId);
      obj.offsetX = e.clientX - obj.x; obj.offsetY = e.clientY - obj.y;
    });
    el.addEventListener('pointermove', e=>{
      if(!obj.grabbed) return; obj.x = e.clientX - obj.offsetX; obj.y = e.clientY - obj.offsetY; updateTrain(obj);
    });
    el.addEventListener('pointerup', e=>{ obj.grabbed=false; checkDrop(obj); });
  })();
</script>
</body>
</html>
